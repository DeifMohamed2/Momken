<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تعديل الفصل - منصة تعليمية</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/teacher-modern.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    .image-upload-container {
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      background-color: var(--bg-light);
      position: relative;
      margin-bottom: 1.5rem;
    }
    
    .image-upload-container.highlight {
      border-color: var(--primary-color);
      background-color: rgba(52, 152, 219, 0.08);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .image-upload-preview {
      margin-bottom: 1.5rem;
      position: relative;
      max-width: 320px;
      margin: 0 auto 1.5rem;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .image-upload-preview:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    
    .image-upload-preview img {
      width: 100%;
      border-radius: 10px;
      max-height: 220px;
      object-fit: cover;
      display: block;
    }
    
    .image-upload-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .hidden {
      display: none;
    }
    
    .upload-progress-container {
      width: 100%;
      height: 10px;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      margin: 1.5rem 0;
      overflow: hidden;
      display: none;
      position: relative;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .upload-progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.3) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      animation: shimmer 1.5s infinite;
      transform: skewX(-20deg);
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%) skewX(-20deg); }
      100% { transform: translateX(100%) skewX(-20deg); }
    }
    
    .upload-status {
      display: none;
      align-items: center;
      justify-content: center;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .upload-status i {
      margin-left: 0.5rem;
    }
    
    .upload-status.uploading {
      color: var(--primary-color);
    }
    
    .upload-status.success {
      color: var(--success-color);
    }
    
    .upload-status.error {
      color: var(--danger-color);
    }
    
    .image-upload-hint {
      margin-top: 1rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .image-upload-hint p {
      margin: 0.25rem 0;
    }
  </style>
</head>
<body>
  <div class="teacher-container">
    <!-- Sidebar -->
    <%- include('./partials/nav.ejs') %>
    
    <!-- Main Content -->
    <main class="teacher-main">
      <!-- Header -->
      <header class="teacher-header">
        <div class="header-left">
          <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
          </button>
          <h1 class="page-title">تعديل الفصل</h1>
        </div>
        
        <div class="header-right">
          <a href="/teacher/chapters" class="btn btn-outline">
            <i class="fas fa-arrow-right"></i>
            العودة للفصول
          </a>
        </div>
      </header>
      
      <!-- Content -->
      <div class="teacher-content">
        <% if (error) { %>
          <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <% if (error === 'missing_fields') { %>
              يرجى ملء جميع الحقول المطلوبة
            <% } else if (error === 'update_failed') { %>
              حدث خطأ أثناء تحديث الفصل
            <% } else { %>
              <%= error %>
            <% } %>
          </div>
        <% } %>
        
        <form id="chapterEditForm" action="/teacher/chapters/<%= chapter._id %>/edit" method="POST" class="needs-validation" novalidate>
          <div class="form-grid">
            <!-- Basic Information -->
            <div class="form-section">
              <h3 class="section-title">المعلومات الأساسية</h3>
              
              <div class="form-group">
                <label class="form-label">اسم الفصل <span style="color: var(--danger-color)">*</span></label>
                <input type="text" class="form-input" id="chapterName" name="chapterName" value="<%= chapter.chapterName %>" required>
              </div>
              
              <div class="form-group">
                <label class="form-label">الصف الدراسي <span style="color: var(--danger-color)">*</span></label>
                <select class="form-select" id="chapterGrade" name="chapterGrade" required>
                  <option value="" disabled>اختر الصف</option>
                  <option value="Grade01" <%= chapter.chapterGrade === 'Grade01' ? 'selected' : '' %>>الصف الأول الاعدادي</option>
                  <option value="Grade02" <%= chapter.chapterGrade === 'Grade02' ? 'selected' : '' %>>الصف الثاني الاعدادي</option>
                  <option value="Grade03" <%= chapter.chapterGrade === 'Grade03' ? 'selected' : '' %>>الصف الثالث الاعدادي</option>
                  <option value="Grade1" <%= chapter.chapterGrade === 'Grade1' ? 'selected' : '' %>>الصف الأول الثانوي</option>
                  <option value="Grade2" <%= chapter.chapterGrade === 'Grade2' ? 'selected' : '' %>>الصف الثاني الثانوي</option>
                  <option value="Grade3" <%= chapter.chapterGrade === 'Grade3' ? 'selected' : '' %>>الصف الثالث الثانوي</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">اللغة <span style="color: var(--danger-color)">*</span></label>
                <select class="form-select" id="ARorEN" name="ARorEN" required>
                  <option value="" disabled>اختر اللغة</option>
                  <option value="AR" <%= chapter.ARorEN === 'AR' ? 'selected' : '' %>>العربية</option>
                  <option value="EN" <%= chapter.ARorEN === 'EN' ? 'selected' : '' %>>الإنجليزية</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">وصف الفصل</label>
                <textarea class="form-input" id="chapterDescription" name="chapterDescription" rows="4"><%= chapter.chapterDescription || '' %></textarea>
                <small style="color: var(--text-secondary); font-size: 0.75rem;">أضف وصفًا مختصرًا للفصل</small>
              </div>
            </div>
            
            <!-- Access & Pricing -->
            <div class="form-section">
              <h3 class="section-title">الوصول والتسعير</h3>
              
              <div class="form-group">
                <label class="form-label">إمكانية الوصول <span style="color: var(--danger-color)">*</span></label>
                <select class="form-select" id="chapterAccessibility" name="chapterAccessibility" required>
                  <option value="" disabled>اختر نوع الوصول</option>
                  <option value="EnterInFree" <%= chapter.chapterAccessibility === 'EnterInFree' ? 'selected' : '' %>>دخول مجاني</option>
                  <option value="EnterInPaid" <%= chapter.chapterAccessibility === 'EnterInPaid' ? 'selected' : '' %>>دخول مدفوع</option>
                </select>
              </div>
              
              <div class="form-group" id="priceGroup">
                <label class="form-label">سعر الفصل</label>
                <div style="position: relative;">
                  <input type="number" class="form-input" id="chapterPrice" name="chapterPrice" min="0" step="0.01" value="<%= chapter.chapterPrice || 0 %>">
                  <span style="position: absolute; top: 50%; left: 1rem; transform: translateY(-50%); color: var(--text-secondary);">جنيه</span>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">صورة الفصل</label>
                <div class="image-upload-container" id="imageUploadContainer">
                  <div class="image-upload-preview" id="imagePreview">
                    <img src="<%= chapter.chapterIMG || '/images/default-chapter.jpg' %>" alt="صورة الفصل" id="previewImage">
                  </div>
                  <div class="image-upload-controls">
                    <label for="fileInput" class="btn btn-secondary" style="margin-bottom: 0;">
                      <i class="fas fa-cloud-upload-alt"></i>
                      اختر صورة
                    </label>
                    <input type="file" id="fileInput" accept="image/*" class="hidden">
                    <input type="hidden" id="chapterIMG" name="chapterIMG" value="<%= chapter.chapterIMG || '/images/default-chapter.jpg' %>">
                    <button type="button" class="btn btn-outline" id="resetImage" style="margin-bottom: 0;">
                      <i class="fas fa-trash-alt"></i>
                      إزالة
                    </button>
                  </div>
                  <div class="upload-progress-container" id="progressContainer">
                    <div class="upload-progress-bar" id="progressBar"></div>
                  </div>
                  <div class="upload-status" id="uploadStatus"></div>
                  <div class="image-upload-hint">
                    <p><i class="fas fa-cloud-upload-alt"></i> اسحب وأفلت الصورة هنا، أو اضغط لاختيار صورة</p>
                    <p class="text-muted"><i class="fas fa-info-circle"></i> الحجم المناسب: 16:9، الحد الأقصى: 2MB</p>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">حالة الفصل</label>
                <select class="form-select" id="isActive" name="isActive">
                  <option value="true" <%= chapter.isActive ? 'selected' : '' %>>نشط</option>
                  <option value="false" <%= !chapter.isActive ? 'selected' : '' %>>غير نشط</option>
                </select>
              </div>
              
              <!-- Advanced Options -->
              <div class="form-group">
                <label class="form-label">خيارات متقدمة</label>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <input type="checkbox" id="isFeatured" name="isFeatured" <%= chapter.isFeatured ? 'checked' : '' %> style="width: auto;">
                  <label for="isFeatured" style="margin: 0;">عرض في الصفحة الرئيسية</label>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Preview -->
          <div class="dashboard-card" style="margin-top: 1.5rem; margin-bottom: 1.5rem;">
            <h3 class="section-title">معاينة الفصل</h3>
            
            <div style="display: flex; gap: 2rem; align-items: flex-start;">
              <div style="flex-shrink: 0; width: 200px; height: 150px; border-radius: var(--radius-lg); overflow: hidden; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); display: flex; align-items: center; justify-content: center;">
                <img id="previewImg" src="<%= chapter.chapterIMG || '/images/default-chapter.jpg' %>" alt="صورة الفصل" style="width: 100%; height: 100%; object-fit: cover;">
              </div>
              
              <div>
                <h3 id="previewName" style="margin-top: 0; margin-bottom: 0.5rem; font-size: 1.5rem;"><%= chapter.chapterName %></h3>
                
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                  <span id="previewGrade" class="status-badge" style="background: var(--info-color);">
                    <% if(chapter.chapterGrade === 'Grade01') { %>
                      الصف الأول الاعدادي
                    <% } else if(chapter.chapterGrade === 'Grade02') { %>
                      الصف الثاني الاعدادي
                    <% } else if(chapter.chapterGrade === 'Grade03') { %>
                      الصف الثالث الاعدادي
                    <% } else if(chapter.chapterGrade === 'Grade1') { %>
                      الصف الأول الثانوي
                    <% } else if(chapter.chapterGrade === 'Grade2') { %>
                      الصف الثاني الثانوي
                    <% } else if(chapter.chapterGrade === 'Grade3') { %>
                      الصف الثالث الثانوي
                    <% } %>
                  </span>
                  
                  <span id="previewAccess" class="status-badge <%= chapter.chapterAccessibility === 'EnterInFree' ? 'active' : 'pending' %>">
                    <%= chapter.chapterAccessibility === 'EnterInFree' ? 'مجاني' : 'مدفوع' %>
                  </span>
                  
                  <% if(chapter.chapterAccessibility === 'EnterInPaid') { %>
                    <span id="previewPrice" class="status-badge" style="background: var(--danger-color);"><%= chapter.chapterPrice %> جنيه</span>
                  <% } %>
                </div>
                
                <p id="previewDescription" style="color: var(--text-secondary); margin-bottom: 0;"><%= chapter.chapterDescription || 'لا يوجد وصف' %></p>
              </div>
            </div>
          </div>
          
          <!-- Form Actions -->
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              حفظ التغييرات
            </button>
            
            <a href="/teacher/chapters/<%= chapter._id %>" class="btn btn-outline">
              <i class="fas fa-times"></i>
              إلغاء
            </a>
            
            <button type="button" id="deleteChapterBtn" class="btn btn-danger">
              <i class="fas fa-trash"></i>
              حذف الفصل
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">تأكيد الحذف</h3>
        <button class="modal-close" onclick="closeDeleteModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 1rem;"></i>
          <p>هل أنت متأكد من حذف الفصل الدراسي "<%= chapter.chapterName %>"؟</p>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">لا يمكن التراجع عن هذا الإجراء</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeDeleteModal()">إلغاء</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">حذف</button>
      </div>
    </div>
  </div>
  
  <script>
    // Sidebar Toggle
    document.getElementById('sidebarToggle').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    });
    
    // Form validation
    const form = document.getElementById('chapterEditForm');
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });

    // Toggle price field based on accessibility
    const accessibilitySelect = document.getElementById('chapterAccessibility');
    const priceGroup = document.getElementById('priceGroup');
    
    function togglePriceField() {
      if (accessibilitySelect.value === 'EnterInPaid') {
        priceGroup.style.display = 'block';
        document.getElementById('chapterPrice').setAttribute('required', 'required');
      } else {
        priceGroup.style.display = 'none';
        document.getElementById('chapterPrice').removeAttribute('required');
      }
    }
    
    togglePriceField();
    accessibilitySelect.addEventListener('change', togglePriceField);

    // Live preview
    const nameInput = document.getElementById('chapterName');
    const gradeSelect = document.getElementById('chapterGrade');
    const accessSelect = document.getElementById('chapterAccessibility');
    const priceInput = document.getElementById('chapterPrice');
    const imgInput = document.getElementById('chapterIMG');
    const descInput = document.getElementById('chapterDescription');
    
    const previewName = document.getElementById('previewName');
    const previewGrade = document.getElementById('previewGrade');
    const previewAccess = document.getElementById('previewAccess');
    const previewImg = document.getElementById('previewImg');
    const previewDescription = document.getElementById('previewDescription');
    
    nameInput.addEventListener('input', function() {
      previewName.textContent = this.value || 'اسم الفصل';
    });
    
    gradeSelect.addEventListener('change', function() {
      let gradeText = '';
      if (this.value === 'Grade01') gradeText = 'الصف الأول الاعدادي';
      else if (this.value === 'Grade02') gradeText = 'الصف الثاني الاعدادي';
      else if (this.value === 'Grade03') gradeText = 'الصف الثالث الاعدادي';
      else if (this.value === 'Grade1') gradeText = 'الصف الأول الثانوي';
      else if (this.value === 'Grade2') gradeText = 'الصف الثاني الثانوي';
      else if (this.value === 'Grade3') gradeText = 'الصف الثالث الثانوي';
      previewGrade.textContent = gradeText;
    });
    
    accessSelect.addEventListener('change', function() {
      if (this.value === 'EnterInFree') {
        previewAccess.textContent = 'مجاني';
        previewAccess.className = 'status-badge active';
        
        // Hide or remove price badge
        const existingPrice = document.getElementById('previewPrice');
        if (existingPrice) existingPrice.remove();
      } else {
        previewAccess.textContent = 'مدفوع';
        previewAccess.className = 'status-badge pending';
        
        // Add or update price badge
        let priceElement = document.getElementById('previewPrice');
        if (!priceElement) {
          priceElement = document.createElement('span');
          priceElement.id = 'previewPrice';
          priceElement.className = 'status-badge';
          priceElement.style.background = 'var(--danger-color)';
          previewAccess.parentNode.insertBefore(priceElement, previewAccess.nextSibling);
        }
        priceElement.textContent = priceInput.value + ' جنيه';
      }
    });
    
    priceInput.addEventListener('input', function() {
      const priceElement = document.getElementById('previewPrice');
      if (priceElement) {
        priceElement.textContent = this.value + ' جنيه';
      }
    });
    
    // Image upload functionality
    // Cloudinary configuration
    const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/dusod9wxt/upload';
    const CLOUDINARY_UPLOAD_PRESET = 'order_project';
    
    // Elements
    const imageUploadContainer = document.getElementById('imageUploadContainer');
    const previewImage = document.getElementById('previewImage');
    const chapterIMGInput = document.getElementById('chapterIMG');
    const fileInput = document.getElementById('fileInput');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const uploadStatus = document.getElementById('uploadStatus');
    
    // Reset image to default
    document.getElementById('resetImage').addEventListener('click', function() {
      previewImage.src = '/images/default-chapter.jpg';
      chapterIMGInput.value = '/images/default-chapter.jpg';
      fileInput.value = '';
      updateUploadStatus('success', 'تم إزالة الصورة بنجاح.');
      
      // Update preview image
      previewImg.src = '/images/default-chapter.jpg';
    });
    
    // File input change handler
    fileInput.addEventListener('change', function(e) {
      if (this.files && this.files[0]) {
        handleFiles(this.files);
      }
    });
    
    // Handle drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      imageUploadContainer.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      imageUploadContainer.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      imageUploadContainer.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
      imageUploadContainer.classList.add('highlight');
    }
    
    function unhighlight() {
      imageUploadContainer.classList.remove('highlight');
    }
    
    imageUploadContainer.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      if (files.length) {
        handleFiles(files);
      }
    }
    
    function handleFiles(files) {
      if (files[0]) {
        const file = files[0];
        
        // Check file size (max 2MB)
        if (file.size > 2 * 1024 * 1024) {
          updateUploadStatus('error', 'حجم الملف كبير جدًا (الحد الأقصى: 2MB)');
          return;
        }
        
        // Check file type
        if (!file.type.match('image.*')) {
          updateUploadStatus('error', 'نوع الملف غير مدعوم. يرجى اختيار صورة.');
          return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.src = e.target.result;
          // Also update the preview in the card
          previewImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
        
        // Upload to Cloudinary
        uploadToCloudinary(file);
      }
    }
    
    function uploadToCloudinary(file) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      
      // Show progress container
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';
      updateUploadStatus('uploading', 'جاري رفع الصورة... <i class="fas fa-spinner fa-spin"></i>');
      
      const xhr = new XMLHttpRequest();
      xhr.open('POST', CLOUDINARY_URL, true);
      
      // Track upload progress
      xhr.upload.onprogress = function(e) {
        if (e.lengthComputable) {
          const percentComplete = Math.round((e.loaded / e.total) * 100);
          progressBar.style.width = percentComplete + '%';
          updateUploadStatus('uploading', `جاري الرفع... ${percentComplete}% <i class="fas fa-spinner fa-spin"></i>`);
        }
      };
      
      xhr.onload = function() {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          chapterIMGInput.value = response.secure_url;
          
          // Update status
          updateUploadStatus('success', 'تم رفع الصورة بنجاح! <i class="fas fa-check-circle"></i>');
        } else {
          updateUploadStatus('error', 'حدث خطأ أثناء رفع الصورة. يرجى المحاولة مرة أخرى. <i class="fas fa-exclamation-circle"></i>');
        }
        
        // Hide progress container after a short delay
        setTimeout(() => {
          progressContainer.style.display = 'none';
        }, 1000);
      };
      
      xhr.onerror = function() {
        updateUploadStatus('error', 'حدث خطأ في الاتصال. يرجى التحقق من اتصالك بالإنترنت. <i class="fas fa-exclamation-circle"></i>');
        progressContainer.style.display = 'none';
      };
      
      xhr.send(formData);
    }
    
    function updateUploadStatus(status, message) {
      uploadStatus.innerHTML = message;
      uploadStatus.className = 'upload-status'; // Clear previous classes
      uploadStatus.classList.add(status);
      uploadStatus.style.display = 'flex';
      
      // Auto-hide success status after 5 seconds
      if (status === 'success') {
        setTimeout(() => {
          uploadStatus.style.display = 'none';
        }, 5000);
      }
    }
    
    // Original image input event for backward compatibility
    imgInput.addEventListener('input', function() {
      previewImg.src = this.value || '/images/default-chapter.jpg';
      previewImage.src = this.value || '/images/default-chapter.jpg';
    });

    // Delete chapter functionality
    const deleteBtn = document.getElementById('deleteChapterBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    
    function showDeleteModal() {
      document.getElementById('deleteModal').classList.add('show');
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('show');
    }
    
    deleteBtn.addEventListener('click', function(e) {
      e.preventDefault();
      showDeleteModal();
    });
    
    confirmDeleteBtn.addEventListener('click', function() {
      // Send delete request
      fetch('/teacher/chapters/<%= chapter._id %>/delete', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          window.location.href = '/teacher/chapters?success=chapter_deleted';
        } else {
          alert('حدث خطأ أثناء حذف الفصل');
          closeDeleteModal();
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ أثناء حذف الفصل');
        closeDeleteModal();
      });
    });
    
    // Close modal when clicking outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeDeleteModal();
      }
    });
  </script>
</body>
</html>